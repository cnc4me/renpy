%
O9012(G229 WORK OFFSET Z,B&H MACRO)
(DESCRIPTION=G229 WORK OFFSET Z,B&H MACRO)
(PROGRAMMER=HENRY LLERE)
(PROGRAM-VERSION=32)
(RUN-TIME=0-00-00)
(CUTTING-TIME=0-00-00)
(SECURITY-CLASS=2)
(PROGRAM-TYPE=0)
(PROGRAM-CLASS=1)
(DOWNLOAD-TARGET=0)
(G229 X? Z? W? T? C? Q? V? H?)

#1=100
WHILE[#1 LT= 147]DO1
#[#1]=#0
#1=#1+1
END1

(THESE VALUES MUST BE SET)
#100=0(FULL 4TH=1, INDEXER=0)
#106=09(SPIND LT  SENSOR ON)
#107=09(SPIND LT  SENSOR OFF)

(DO NOT CHANGE)
#103=-.75 (DEFAULT FEED IN Z)
#104=.175(1ST TOUCH RETRACT)
#105=226(TOOL OFFSET DATA)
#108=226(SPINDLE SENSOR TOOL #)
#148=#108
#113=.02(DEFAULT Q VALUE)
#116=75(FAST FEEDRATE)
#102=#24(STORE X AXIS PROG.)
#117=#[11000+#105]+#[10000+#105](RECORD H)
#118=.002(IN-POSITION CHECK TOL.)
#119=4.(MEASURE FEEDRATE)
#144=#4114
#145=#4014
#146=#4003
#149=#0
IF[#3 EQ #0] GOTO6
IF[#3 GT 1] GOTO4
#3=#3*10000
N4#3=ROUND[#3]
IF[#3 GT= 3] GOTO205
GOTO7
N6#3=0(TO CHANGE OFFSET)
IF[#11 EQ #0] GOTO7
#3=1.
N7(WORK OFFSET CHECK & CONFIG.)
IF[#23 EQ #0] GOTO20
IF[#23 GT= 1.] GOTO8
#23=#23*10000
N8#23=ROUND[#23]
IF[#23 GT 100] GOTO10
IF[#23 LT 59] GOTO15
N10#109=1(WORK OFFSET INPUT +)
IF[#23 GT 159] GOTO200
IF[#23 GT= 154] GOTO11
#23=#23-100
G54.1P#23
GOTO20
N11
#23=#23-100
G#23
GOTO20
N15#109=0(WORK OFFSET INPUT CLEAR COMMON)
IF[#3 EQ 1] GOTO16
IF[#3 EQ 2] GOTO16
G90G10L2P0Z0
N16IF[#23 LT 1] GOTO200
IF[#23 GT= 54] GOTO19
G54.1P#23
GOTO20
N19
G#23
N20
IF[#148 NE #108] GOTO201
IF[#4014 EQ 54.1] GOTO25
IF[#4014LT54] GOTO202
IF[#4014 GT 59] GOTO202
#110=2
#112=#4014
#111=#112-53
GOTO30
N25
IF[#4130LT1.] GOTO202
IF[#4130 GT 48.] GOTO202
#110=20
#111=#4130
#112=#111
N30(STORE START POS.)
IF[#3 EQ 2] GOTO31
IF[#11 NE #0] GOTO32
IF[#24 EQ #0] GOTO32
N31#20=#0
N32G80G40
(***M#106***)
M87
G4P500
#121=#5041
#122=#5042
#123=#5043
#124=#5044
#133=#5003
IF[#3 EQ 2] GOTO160
N35(X+AXIS PROTECTED POS. MOVE)
IF[#24 EQ #0] GOTO40
G31X[#121+[#24/2]]F[#116*2]
G4P100
IF[ABS[#5061-[#121+[#24/2]]] GT= #118] GOTO203
N40(Z-AXIS FIRST TOUCH X+SIDE)
IF[#6 NE #0] GOTO41
IF[#26 NE #0] GOTO41
#6=#103
N41#7=ABS[#6]
G91G31Z[#26+#6]F#116
G4P100
#114=#123+#26+#6
IF[ABS[#5063-#114] LT #118] GOTO42
G91G0Z#104
IF[#11 NE #0] GOTO43
IF[#20 NE #0] GOTO44
GOTO43
N42
IF[#20 NE #0] GOTO150
G90G0Z#133
GOTO204
N43#3004=2(FEEDRATE LOCK OUT)
G4P100
#123=#5003
#134=#123-#7+#118
G91G31Z[#103/2]F#119
G4P100
#3004=0
#126=#5063
#127=-#126
#128=#126-[#[11000+#105]+#[10000+#105]]
N44G90G0Z#133
IF[#11 NE #0] GOTO50
IF[#20 NE #0] GOTO130
X#121Y#122
(SECOND TOUCH X- SIDE)
N40(X-AXIS POS. MOVE)
IF[#24 EQ #0] GOTO50
G31 X[#121-[#24/2]] F[#116*2]
G4 P100
IF[ABS[#5061-[#121-[ABS[#24/2]]]] GT= #118] GOTO203
N45(Z-FIRST TOUCH X-SIDE)
IF[#6 NE #0] GOTO46
#6=#103
N46#7=ABS[#6]
G91G31Z[#26+#6]F#116
G4P100
IF[ABS[#5063+[#123+#26+#6]] LT [#118*2]] GOTO204
G91G0Z#104
#3004=2(FEEDRATE LOCK OUT)
G4P100
#123=#5043
#134=#123-#7+#118
G91G31Z[#6/2]F#119
G4P100
#3004=0
#126=#5063
#127=-#126
#129=#126-#[11000+#105]
G90G0Z#133
X#121Y#122
IF[#134 GT #5043] GOTO204
N50
IF[#11 NE #0] GOTO75
IF[#3 EQ 1] GOTO75
IF[#24 NE #0] GOTO60
G91G10L#110P#111Z0
GOTO75
N60IF[#24 EQ #0] GOTO75
#130=#129-#128
#131=#130
IF[#130 GT= 0] GOTO65
#131=-#130
N65
#132=ATAN[#131]/[#102]
IF[#130 GT= 0] GOTO70
#132=-#132
IF[#100  EQ 1] GOTO70
#132=ROUND[#132]
N70G91G10L#110P#111B#132
N75(WORK OFFSET SETTING)
G90G0M#107
IF[#11 NE #0] GOTO80
IF[#3 EQ 1] GOTO80
IF[#24 NE #0] GOTO130
IF[#109 EQ 1] GOTO76
G91G10L#110P#111Z[#128+#22]
GOTO130
N76(INPUT +)
G91G10L#110P#111Z[#128+#22]
GOTO130
N80(CHECKING TOL.)
IF[#17 EQ #0] GOTO85
#113=#17
N85IF[#110 EQ 20] GOTO100
#115=#[5203+[#111*20]]
#135=#128
IF[#135 GT= 0] GOTO105
#135=ABS[#135]
N105
IF[#11 NE #0] GOTO120
IF[#135 GT #113] GOTO206
GOTO130
N100(G54.1 SETTING CHECK)
#115=#[6983+[#111*20]]
#135=#128
IF[#135 GT= 0] GOTO110
#135=ABS[#135]
N110
IF[#11 NE #0] GOTO120
IF[#135 GT #113] GOTO206
GOTO130
N120(DEPTH CHECK & H OFFSET ADJUST)
#136=#135-ABS[#22]
#[11000+#11]=#[11000+#11]+#136
IF[#136LT0] GOTO125
IF[#20 NE #0] GOTO121
#20=#11
N121
IF[ABS[#136] GT #113] GOTO206
GOTO130
N125IF[#20 NE #0] GOTO126
#20=#11
N126IF[ABS[#136] GT #113] GOTO150
N130G#146
M99

N150
G90G0Z#133
G#146
M99P#20

N160(CALIBRATION H199)
G4P100
G91G31Z[#103*6]F[#116/2]
G4P10
G0Z#104
#3004=2
G91G31Z[#103/2]F#119
G4P200
#138=#5063
#139=#[11000+#105]
#140=#138-#139
#135=#140
#[11000+#105]=#[11000+#105]+#140
#[10000+#105]=0
#3004=0
G90G0Z#133
(***M#107***)
G#146
M99

N199#3000=1(USE G329 FOR Z WORK OFFSET PROBING)
N200#3000=2(WRONG WORK OFFSET PROGRAMMED UNDER "W")
N201#3000=3(USE T99 SENSOR TOOL ONLY)
N202#3000=4(SET G54-G59 OR G54.1 P1-48)
N203#3000=5(PROBE INTERFERENCE)
N204#3000=6(PROBE DID NOT TOUCH IN Z)
N205#3000=7(C MUST=2,1,0 OR OMITTED)
N206#3000=8(Z POS. OUT OF TOL.)
M99


%

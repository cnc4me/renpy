%
O7997(POINTS AT Z VERIFICATION V2)

( G65 P7997 )
( G65 P7997 X1.2 )
( G65 P7997 X1.2 Y2.3 )
( G65 P7997 X1.2 Y2.3 Z0.)

( X - X LOCATION IF GIVEN | CURRENT X IF MISSING)
( Y - Y LOCATION IF GIVEN | CURRENT Y IF MISSING)
( Z - Z POSITION IF GIVEN | Z0. IF MISSING )

#9=200. ( PROTECTED POSITIONING FEEDRATE )
#18=.2 ( RETRACT PLANE )

( USE PASSED Z IF GIVEN )
IF[#26 NE #0] GOTO30
#26=0.
N30

( ADD EXTRA Z TO RETRACT PLANE )
#1=[#26+#18]

(PROBE_ON)

( APPROACH PART )
G65 P9810 Z[#1 + 1.] M1.
IF[#148 NE 0] GOTO911 ( PATH OBSTRUCTION )

IF[#24 EQ #0] GOTO10 ( SKIP IF NO X PARAMETER )
G65 P9810 X#24 F#9 ( MOVE TO X LOCATION )
N10

IF[#25 EQ #0] GOTO20 ( SKIP IF NO Y PARAMETER )
G65 P9810 Y#25 F#9 ( MOVE TO Y LOCATION )
N20

( APPROACH RETRACT PLANE )
G65 P9810 Z[#1 + 1.] M1.
IF[#148 NE 0] GOTO911 ( PATH OBSTRUCTION )

G65 P9810 Z#1 M1.
IF[#148 NE 0] GOTO911 ( PATH OBSTRUCTION )

( TRY AND TOUCH SURFACE OF MATERIAL )
( IF NOT WITHIN TOLERANCE TO , JUMP TO Tnnn )
G229 Z-[#26 + .03] T910

G65 P9810 Z[#1 + 1.] F#9

M01 ( Z PLANE FOUND )
M99

(---------------------------)
(  CHECKS FAILED SOMEWHERE  )
(---------------------------)
N910
M01 ( MATERIAL NOT FOUND! )
GOTO3000

N911
M01 ( THERE SHOULD BE... NO TOUCHING! )
GOTO3000


N3000
( PROBING FAILED )
G91 G1 Z1. F50.
G65 P9833
M107
M30

( V1 - INITIAL WORKING VERSION )
( V2 - FIXING RETRACT PLANE ISSUE )
%
